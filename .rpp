#!/bin/sh
#
# rperre's PROMPT
# This should be included on your bash profile script
#

branch() {
	if [ "$(echo `git rev-parse --git-dir 2> /dev/null;`)"  != "" ]; then
		B=`git branch 2> /dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/\1/'`
		P=$(basename `git rev-parse --show-toplevel 2> /dev/null`) 2> /dev/null
		echo "{$P/${B//[[:blank:]]/}}"	
	fi;
}

modified() {
	if [ "$(echo `git rev-parse --git-dir 2> /dev/null;`)"  != "" ]; then
		M=`git ls-files -m 2> /dev/null | wc -l`
		if [ "$M" -gt "0" ]; then
			echo " M:${M//[[:blank:]]/}"
		fi;
	fi;
}

untracked() {
	if [ "$(echo `git rev-parse --git-dir 2> /dev/null;`)"  != "" ]; then
		U=`git ls-files --others --exclude-standard 2> /dev/null | wc -l`
		if [ "$U" -gt "0" ]; then
			echo " U:${U//[[:blank:]]/}"
		fi;
	fi;
}


git_folder() {
	if [ "$(echo `git rev-parse --git-dir 2> /dev/null;`)"  != "" ]; then
		B=`git branch 2> /dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/\1/'`
		if [ "$B" != "" ]; then
			echo ""
			echo "[G]"
		fi;
	fi;
}

normal_folder() {
	if [ "$(echo `git rev-parse --git-dir 2> /dev/null;`)"  = "" ]; then
		echo "[L]"
	fi;
}

staged() {
	if [ "$(echo `git rev-parse --git-dir 2> /dev/null;`)"  != "" ]; then
		S=`git diff --cached --numstat 2> /dev/null | wc -l`
		if [ "$S" -gt "0" ]; then
			echo " S:${S//[[:blank:]]/}"
		fi;
	fi;
}

unpushed() {
	if [ "$(echo `git rev-parse --git-dir 2> /dev/null;`)"  != "" ]; then
		S=`git log --branches --not --remotes 2> /dev/null | grep "commit "| wc -l`
		if [ "$S" -gt "0" ]; then
			echo " NEEDS PUSH!(${S//[[:blank:]]/})"
		fi;
	fi;
}

uptodate() {
	# needs pull check
	echo ""	
}

current_folder() {
	echo "../$(basename `pwd`)"
}

A='$(branch)'
B='$(modified)'
C='$(untracked)'
D='$(git_folder)'
E='$(normal_folder)'
F='$(staged)'
G='$(unpushed)'
H='$(current_folder)'

SH_RESET="\e[0m"

SH_WHITE="\[\033[1;37m\]"
SH_BLUE="\[\033[1;34m\]"
SH_RED="\[\033[1;31m\]"
SH_GREEN="\[\033[1;32m\]"
SH_YELLOW="\[\033[1;33m\]"

BL_ANGLE="\342\224\224"
TL_ANGLE="\342\224\214"
HORIZ_LINE="\342\224\200"

BRANCH_COLOR="$SH_BLUE"
MODIFIED_COLOR="$SH_YELLOW"
UNTRACKED_COLOR="$SH_YELLOW"
GITFOLDER_COLOR="$SH_YELLOW"
NORMALFOLDER_COLOR="$SH_GREEN"
STAGED_COLOR="$SH_GREEN"
UNPUSHED_COLOR="$SH_RED"
UPTODATE_COLOR="$SH_GREEN"

PS1="${BRANCH_COLOR}$A${MODIFIED_COLOR}$B${UNTRACKED_COLOR}$C${STAGED_COLOR}$F${UNPUSHED_COLOR}$G${GITFOLDER_COLOR}$D${NORMALFOLDER_COLOR}$E${SH_WHITE}[$H]$ ${SH_RESET}"

